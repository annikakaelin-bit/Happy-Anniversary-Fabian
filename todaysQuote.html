<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="love you!">
  <meta name="description" content="Happy Anniversary Fabian! I love you more than even I realize sometimes. This is just something you can look at when you want a reminder of that.">
  <title>To Fabian</title>
  <style>
    em { color: rgb(103, 17, 55); text-align: center; font-family: Arial, sans-serif; font-size: 80%; }
    body { background-color: rgb(112, 169, 205); color: rgb(34, 35, 72); text-align: center; font-family: Arial, sans-serif; font-size: 85%; }
    img { max-width: 80%; height: auto; display: block; margin: 1rem auto; }
    #img { margin: 1rem auto; max-width: 65%; }
  </style>
</head>
<body>
  <h1>To Fabian</h1>
  <h2></h2>
  <h3></h3>

  <!-- container where the image will be inserted -->
  <div id="todayImg" aria-live="polite"></div>

  <!-- optional diagnostic / contents preview -->
  <div id="output" aria-hidden="false"></div>

  <script>
    
          const fs = require('fs');
    
    // data = path to CSV-like file
    function pullPromt(data) {
        // --- Read the file into a 2D array (cells) ---
        const raw = fs.readFileSync(data, 'utf8');
        const cells = raw
            .split(/\r?\n/)
            .filter(line => line.trim() !== '')
            .map(line => line.split(','));   // adjust if your delimiter is different
    
        // --- Separate headers and rest ---
        const headers = cells[0];
        const rest = cells.slice(1);
    
        const r = rest.length;
        const c = rest[0].length;
        const amount = r * c;
    
        // --- Pick random index (MATLAB is 1‑based, JS is 0‑based) ---
        let index = Math.floor(Math.random() * amount);  // 0..amount-1
    
        // --- Compute column location (MATLAB logic preserved) ---
        let loc = Math.floor(index / (r - 1));
        if (index % r !== 0) {
            loc = loc + 1;
        }
    
        // MATLAB uses 1-based indexing; JS uses 0-based
        const title = headers[loc - 1];
    
        // --- Default image ---
        let quoteimg = 'heart.png';
    
        // --- Extract quote ---
        let flatRest = rest.flat(); // flatten row-major like MATLAB linear indexing
        let quote = '';
    
        if (flatRest[index] && typeof flatRest[index] === 'string') {
            quote = flatRest[index];
        } else {
            if (index < amount - 1) {
                index = index + 1;
            } else {
                index = index - 1;
            }
            quote = flatRest[index];
        }
    
        // --- Special case: loc == 2 ---
        if (loc === 2) {
            quoteimg = flatRest[index];
            quote = 'love you ;)';
        }
    
        // --- Write output file ---
        const info = [title, quote, quoteimg];
        const output = info.join('\n');
    
        fs.writeFileSync('Fabina&Annika', output);
    
        return { title, quote, quoteimg };
    }
    
    module.exports = pullPromt;

    // CONFIG: set the raw base (branch or commit) and the text file path (relative to repo root)
    // You may use a commit SHA (immutable) or branch name like 'main' (may change).
    const RAW_BASE = 'https://annikakaelin-bit.github.io/Happy-Anniversary-Fabian/';
    const TEXT_FILE_PATH = 'fabian-annika.txt'; // <-- replace with the actual text file path in the repo

    const output = document.getElementById('output');
    const heading1 = document.querySelector('h1');
    const heading2 = document.querySelector('h2');
    const heading3 = document.querySelector('h3');
    const imgContainer = document.getElementById('todayImg');

    load the text file from the repo and display image referenced on line 3
    function loadTextFileFromRepo() {
      const url = RAW_BASE + TEXT_FILE_PATH;

      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error('HTTP ' + response.status + ': ' + response.statusText);
            return response.text();
        })
        .then(text => {
          const lines = text.split(/\r?\n/);
          const line1 = module.tile//lines[0] !== undefined ? lines[0].trim() : '';
          const line2 = module.quote //lines[1] !== undefined ? lines[1].trim() : '';
          const line3 = module.quoteimg//lines[2] !== undefined ? lines[2].trim() : '';

          heading2.textContent = line1 || '';
          heading3.textContent = line2 || '' ; // not used

          imgContainer.innerHTML = '';
          if (!line3) {
            imgContainer.textContent = 'No image filename or URL found on line 3.';
            return;
          }

          // If line3 already looks like a full URL or data URL, use it directly.
          let imgSrc = RAW_BASE + line3;
          

          const Today = document.createElement('img');
          Today.src = imgSrc;
          Today.alt = 'whoops! no image today';
          Today.addEventListener('error', () => {
            Today.textContent = 'Could not load image: ' + imgSrc;
          });
          imgContainer.appendChild(Today);
        })
        .catch(err => {
          output.textContent = 'Failed to fetch file: ' + err.message;
          imgContainer.textContent = '';
        });
    }

    // Run on load
    loadTextFileFromRepo();
  </script>
</body>
</html>
